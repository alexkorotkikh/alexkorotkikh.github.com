<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Singleton Post]]></title>
  <link href="http://alexkorotkikh.github.com/atom.xml" rel="self"/>
  <link href="http://alexkorotkikh.github.com/"/>
  <updated>2013-04-11T09:27:25+03:00</updated>
  <id>http://alexkorotkikh.github.com/</id>
  <author>
    <name><![CDATA[Alex Korotkikh]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[О проблеме хорошего кофе]]></title>
    <link href="http://alexkorotkikh.github.com/blog/2013/04/11/about-good-coffee/"/>
    <updated>2013-04-11T09:06:00+03:00</updated>
    <id>http://alexkorotkikh.github.com/blog/2013/04/11/about-good-coffee</id>
    <content type="html"><![CDATA[<p>Просто удивительно, до чего трудно бывает найти кофейню, в которой подают хороший кофе. В Гамбурге, например, я за 4 недели пребывания не нашёл ничего лучше, чем Starbucks. А будем откровенны, Starbucks - это фастфуд. Кофе там пить, конечно, можно, и он даже неплохой, но это, всё-таки, кофейный фастфуд, как McDonald&#8217;s по отношению к обычному ресторану - &#8220;скромненько, но чистенько&#8221;, для невзыскательной публики.</p>

<p>В Харькове тоже всё не так просто. С одной стороны, есть &#8220;Кофеин&#8221; и &#8220;Золотой дукат&#8221; - кофецентричные заведения с большим выбором зёрен и способов приготовления, включая аэропресс и турку. Есть франчайзы &#8220;Дома кофе&#8221; и Blasercafe, где также богатый выбор зёрен, но готовят кофе, как правило, только в эспрессо-машинах.</p>

<p>Ещё есть сетевые кофейни вроде Coffee Life или &#8220;Шоколадки&#8221;. Рассчитаны они, как мне кажется, на не особо требовательную в плане кофе аудиторию. В &#8220;Шоколадке&#8221; зёрна откровенно пережаренные, а в Coffee Life качество кофе очень зависит от фазы луны и настроения баристы, но в среднем примерно соответствует своему &#8220;старшему брату&#8221; Starbucks, с которого он с таким усердием слизан.</p>

<p>Удивительным открытием для меня стала кофейня McCafe (в ТЦ Ave Plaza на Сумской). При условии, что это дочерний бренд McDonald&#8217;s, в котором вместо кофе подают совершенно невразумительную бурду, McCafe варит очень и очень достойный американо - много лучше соседнего Coffee Life и соперничающий по качеству с моим любимым &#8220;Кофеином&#8221;. Главное, чтоб со временем не испортились.</p>

<p>Отдельная, очень грустная, история - это кофе в не кофецентричных заведениях. Я пока не встречал ресторана или кафе, которое бы варило приличный кофе, одновременно специализируясь на других вещах, например, суши, итальянской или  украинской кухне. Вот и приходится, пообедав в одном месте, идти покупать кофе в другом.</p>

<p>Хотя, дай бог, чтоб это была наша самая большая проблема.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Гамбургские заметки]]></title>
    <link href="http://alexkorotkikh.github.com/blog/2013/03/02/hamburg-notes/"/>
    <updated>2013-03-02T22:47:00+02:00</updated>
    <id>http://alexkorotkikh.github.com/blog/2013/03/02/hamburg-notes</id>
    <content type="html"><![CDATA[<ul>
<li><p>У меня при слове &#8220;бюргер&#8221; обычно возникал перед глазами образ немолодова и обязательно толстого мужчины. Так вот, тут таких практически нет. Во всяком случае, я за неделю ни разу не видел. Зато очень много велосипедистов и бегунов самого разного возраста.</p></li>
<li><p>Почему-то считается, что немки некрасивые. Немки-то может и некрасивые, но Германия - страна эмигрантом. Поэтому тут везде итальянки, испанки, польки, русские&#8230; и все они, в среднем, довольно симпатичные.</p></li>
</ul>


<!-- more -->


<ul>
<li><p>Про велосипедистов. Везде есть отдельные дорожки для них, либо помеченные цветом, либо отделённые чертой. И даже на светофорах есть знаки &#8220;пешеход&#8221; и &#8220;велосипедист&#8221;.</p></li>
<li><p>Аэропорт города Любек, куда я прилетел, сильно меньше и скромнее терминала А аеропорта &#8220;Киев&#8221; (он же &#8220;Жуляны&#8221;), откуда я вылетал. Почему-то складывается ощущение, что для нас аэропорт - это что-то большое и торжественное, типа ворот в другой мир, а для немцев - простое и обыденное, как автобусная остановка.</p></li>
<li><p>В Гамбурге нету высоких зданий. Обычно жилые дома не больше 5-6 этажей. Кто-то мне сказал, что по правилам города здания не должны быть выше чем городская ратуша. Не знаю, правда ли.</p></li>
<li><p>Ещё про здания. Каждое здание не похоже на другое. У каждого жилого дома свой вход, оформление подъезда, внешний вид фасада. Нет ощущения, что ты ходишь между клонированными близнецами.</p></li>
<li><p>Плюс ко всему, легко может оказаться, что в целом квартале жилых домов нет ни одного продуктового магазина. А тот, что есть, закрывается в 8 вечера. И никого не волнует, что ты только пришёл с работы - продавцы в магазинах тоже хотят домой, к детям.</p></li>
<li><p>Цены на продукты вполне сравнимы с нашими. А вот качество часто лучше. Очень вкусные сыры - даже те, которые продаются уже нарезанными и запаянными в полиэтилен. Хорошие свежие овощи, которые пахнут овощами. Про колбаски я молчу, они вне конкуренции. А полуфабрикаты, в отличие от украинских, вполне можно есть.</p></li>
<li><p>Кстати, обратил внимание на неприятный факт. Немцы никогда не моют руки перед едой. Ну то есть приходит компания в кафе, садится за столик, делает заказ, им приносят какие-нибудь булочки и соус, чтоб не скучно было ждать. И все спокойно начинают прямо руками брать эти булочки и есть, и мальчики, и девочки. Что это - незнание правил гигиены или опыт передовых учёных мира - я не знаю.</p></li>
<li><p>Не знаю, как в больших корпорациях и государственных учреждениях, но в нашем небольшом стартапе я, заканчивая работу в восемь вечера, был одним из первых уходящих из офиса. Некоторые работают до полуночи каждый день, а в десять утра уже опять на работе. Было несколько человек, которые сели работать в одиннадцать вечера, после корпоративной пьянки. Наверное, это всё-таки больше относится к стартапу, а не к немецкой культур, но всё равное интересно.</p></li>
<li><p>Тут как-то совсем плохо с интернетом. Во-первых, он есть далеко не в каждой кафешке или ресторане. Во-вторых, там где он всё таки есть, он может быть не бесплатным. В Старбаксе, например, он бесплатный, а в другой большой сети кофеен, Balzac Coffee, при покупке кофе вам дадут логин и пароль на пол часа бесплатного использования, а всё, что больше - 1 евро/час. В-третьих, в нашем, например, офисе, с интернетом постоянные проблеиы. Скорокти часто не хватает на то, чтобы поболтать в скайпе без видео. И в-четвёртых, в квартирах, которые сдают в аренду, интернета может не быть вообще. Мне попалась одна такая, когда мне в срочном порядке искали новую квартиру после отмены рейса до Киева.</p></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Шпаргалка про производительность]]></title>
    <link href="http://alexkorotkikh.github.com/blog/2013/03/01/highload-problem-cheatsheet/"/>
    <updated>2013-03-01T18:00:00+02:00</updated>
    <id>http://alexkorotkikh.github.com/blog/2013/03/01/highload-problem-cheatsheet</id>
    <content type="html"><![CDATA[<p><em>Участвуя в конкурсе <a href="http://uwc.org.ua">UA Web Challenge</a> я описал в одном документе всю информацию про причины снижения произвоительности, которые я знаю. Буду рад, если это кому-то пригодится. Также буду рад дополнениям и изменениям.</em></p>

<p>Проблемы производительности сильно зависят от приложения. Я постараюсь описать все известные мне типы проблем и предложить их способы решения. Каждое решение будет рассмотрено с точки зрения скорости его применения, стоимости и “фундаментальности” (насколько глубокие проблемы оно решает).</p>

<!-- more -->


<h2>Горизонтальное масштабирование</h2>

<p>Как правило, проблемы высокой нагрузки появляются внезапно, и решить их нужно как можно быстрее. С этой точки зрения увеличение количества серверов является, часто, самым простым способом. Естественно, во многих случаях это будет лечением симптомов, а не самой болезни, но это может помочь выиграть время для более детального анализа и качественного решения.</p>

<p>Плюсы:</p>

<ul>
<li>Невероятно низкое время реализации. Современные облачные платформы вроде AWS или Heroku позволяют поднять новый инстанс в течении нескольких минут. В случае собственного кластера может быть дольше и дороже, но если он качественно администрируется, добавления ещё одного сервера и развёртывание на нём приложения также не дол жно занять много времени</li>
</ul>


<p>Минусы:</p>

<ul>
<li>Как правило, будет временным решением, кроме случаев, когда никаких других проблем нет и оптимизировать нечего (но мы же взрослые люди и понимаем, что так не бывает :)).</li>
<li>Не все проблемы могут быть решены добавлением сервера. Например, если имеет место утечка памяти, то на новом сервере память точно так же уйдёт в своп, и особого прироста производительности может не быть.</li>
<li>Увеличение расходов на инфраструктуру.</li>
</ul>


<h2>Балансировка нагрузки</h2>

<p>Самым простым алгоритмом работы балансировщика нагрузки является Round-robin, который передаёт запросы на обработку различным серверам “по кругу”, т.е., каждому по очереди, в независимости от его загруженности. Такой подход может быть не эффективным при большом количестве запросов, потому что никак не страхует от ситуации, при которой сложные, требующие большого количества ресурсов на обработку, запросы попадают на сервер, который использует свои мощности на максимуме, в то время как другой простаивает. Помочь может использование другого алгоритма, который передаёт запрос на обработку тому серверу, у которого на данный момент меньше всего занятых ресурсов.</p>

<p>Плюсы:</p>

<ul>
<li>Распределяет нагрузку равномерно по всему кластеру, значит, ресурсы используются более эффективно</li>
</ul>


<p>Минусы:</p>

<ul>
<li>Требуется время на реализацию (или использование существующего) решения</li>
</ul>


<h2>Память</h2>

<p>Другой проблемой может быть нехватка памяти. Например, при увеличении количества запросов к приложению увеличился и объём данных, которые загружаются из БД и хранятся в памяти. Когда место в памяти закончилось, ОС начала использовать swap на жёстком диске, а работа с ним, как известно, в разы медленнее работы с оперативной памятью.
Что можно сделать в этом случае?</p>

<h3>Добавить памяти</h3>

<p>Поставить больше памяти в свой сервер или изменить тип инстанса “в облаке”, как правило, довольно просто (есть исключения, например, инстансы на Heroku имеют фиксированную конфигурацию без возможности поменять что либо)</p>

<p>Плюсы:</p>

<ul>
<li>Может быть быстро и не очень дорого</li>
</ul>


<p>Минусы:</p>

<ul>
<li>Временное решение, поскольку нагрузка может увеличиваться практически неограниченно, а объём памяти - нет.</li>
<li>В некоторых случаях может не помочь. Если существует утечка памяти, она может съесть любой объём.</li>
</ul>


<h3>Проверить на утечки памяти</h3>

<p>Типичная проблема для языков без сборки мусора, но может встречаться и в языках, которые используют GC.</p>

<p>Плюсы:</p>

<ul>
<li>“Фундаментальное” решение.</li>
</ul>


<p>Минусы:</p>

<ul>
<li>Может занять непредсказуемое время. Профилирование и сравнение снэпшотов - довольно кропотливое и долгое занятие.</li>
</ul>


<h3>Настроить сборку мусора</h3>

<p>Платформы, которые имеют сборщик мусора (JVM, .NET etc), как правило, предоставляют широкие возможности по его тонкому тюнингу. Сам процесс сборки мусора является достаточно ресурсоёмким и может быть причиной снижения производительности.</p>

<p>Плюсы:</p>

<ul>
<li>Может привести к увеличению производительности (как существенному, так и не очень)</li>
</ul>


<p>Минусы:</p>

<ul>
<li>Требует глубоких знаний принципов работы платформы, того, как она работает с памятью (поколения объектов, стратегии сборки и пр.)</li>
</ul>


<h2>Канал связи</h2>

<p>Для некоторых типов приложений (например, видео- или фотохостинг) пропускная способность канала может быть критичным показателем. Я вижу два способа решения этой проблемы</p>

<h3>Увеличить канал</h3>

<p>Плюсы:</p>

<ul>
<li>Может помочь, но, как и в случае с памятью, количество трафика может расти быстрее скорости увеличения канала.</li>
</ul>


<p>Минусы:</p>

<ul>
<li>Не всегда возможно, либо не всегда возможно быстро</li>
<li>Может быть очень дорого</li>
</ul>


<h3>Уменьшить количество данных</h3>

<p>Уменьшение объёма передаваемых данных может быть сделано разными способами, которые зависят от типа этих данных. В случае с бинарными данными, вроде изображений или видео, можно использовать решения вроде AWS S3, оптимизированные для подобных задач, и таким образом перенаправить трафик на другой канал данных, освободив свой собственный.</p>

<p>В случае с REST API, который, например, возвращает массив JSON-объектов, можно пересмотреть формат возвращаемых данных. Например, можно уменьшить названия полей в объекте (“lat” вместо “latitude”, “long” вместо “longitude”, “app” вместо “application” и т.д.). Это напрямую уменьшит размер HTTP ответа и поможет выиграть несколько десятков процентов от загрузки канала.</p>

<p>Другим вариантом может быть изменение структуры возвращаемых объектов. Например, могут быть ситуации, когда сервис возвращает объект из БД со всеми его связями, в то время как пользователи этого сервиса используют только несколько полей.</p>

<p>Плюсы:</p>

<ul>
<li>В некоторых случаях может принести большой эффект, с запасом</li>
</ul>


<p>Минусы:</p>

<ul>
<li>Чем больше приложений используют API, тем больше времени потребуется на переработку. Если же API публичный и используется сторонними разработчиками, то может пройти очень много времени, прежде чем существенная их часть перепишет свои приложения для использования новой версии API.</li>
</ul>


<h2>База данных</h2>

<h3>Шардинг</h3>

<p>Для уменьшения нагрузки на сервер БД можно разнести данные по нескольким серверам (например, все данные о заказах с чётными индексами хранить на одном сервере, а с нечётными - на другом).</p>

<p>Плюсы:</p>

<ul>
<li>В случае, если структура данных позволит не делать join-ы между таблицами, которые хранятся на разных серверах, может обеспечить практически линейный рост производительности.</li>
</ul>


<p>Минусы:</p>

<ul>
<li>Приложение должно знать о том, с какой базой в каком случае нужно работать.</li>
</ul>


<h3>Пул соединений</h3>

<p>Плюсы:</p>

<ul>
<li>Правильно подобранный размер пула обеспечит и уменьшение времени отклика, и более эффективное использование памяти.</li>
</ul>


<p>Минусы:</p>

<ul>
<li>Вычислить правильный размер пула не всегда просто, однако <a href="http://stackoverflow.com/questions/1800340/how-to-calculate-the-size-for-a-database-connection-pool">способы есть</a>.</li>
</ul>


<h3>Оптимизация запросов</h3>

<p>Данная проблема особенно актуальна при использовании ORM, так как тот SQL-код, который ими генерируется, не обязательно будет оптимальным. Например, необходимо быть уверенным, что запрос на выборку данных из таблицы А не выгружает заодно и данные из таблицы Б, которая связана с А отношением один-ко-многим (естественно, если данные из Б в данном случае не нужны).</p>

<p>Плюсы:</p>

<ul>
<li>В некоторых случаях возможно увеличение производительности на порядок.</li>
</ul>


<p>Минусы:</p>

<ul>
<li>Поиск проблемных запросов может занять неопределённе время.</li>
<li>Их оптимизация - тоже.</li>
</ul>


<h3>Кэш второго уровня (результатов запросов)</h3>

<p>Плюсы:</p>

<ul>
<li>Достаточно простая реализация при использовании некоторых стандартных технологий (например, Hibernate + Ehcache)</li>
</ul>


<p>Минусы:</p>

<ul>
<li>Нетривиально и небыстро, если нужно делать с нуля.</li>
<li>Могут быть проблемы в связке с горизонтальным масштабированием. Если инстансы ничего не знают друг про друга, необходим новый сервер, доступ к которому будут иметь все инстансы. Однако, в этом случае эффективность кэша может упасть из-за увеличения сетевых издержек.</li>
</ul>


<h3>Отказ от реляционной модели</h3>

<p>NoSQL сейчас в моде, и в некоторых случаях он действительно может быть полезен. Проблема в том, что нельзя просто заменить MySQL на MongoDB и ожидать большого прироста производительности. Модель данных определяет способы работы с этими данными, и её изменение влечёт за собой изменения способов взаимодействия. Это требует серьёзного “сдвига парадигмы” у разработчиков.
Многократное увеличение производительности в случаях, когда данные хорошо ложатся на новую модель данных (document-oriented, column-based, key-value etc).</p>

<p>Плюсы:</p>

<ul>
<li>Как правило, более простое горизонтальное масштабирование.</li>
</ul>


<p>Минусы:</p>

<ul>
<li>Издержки на изучение новой технологии, реализацию решения, тестирование, миграцию данных</li>
<li>При неправильном использовании может стать только хуже</li>
</ul>


<h2>Асинхронное выполнение задач</h2>

<p>Часть задач может быть выполнена уже после того, как пользователь получил ответ от сервера. Например, если одно из его действий должно инициировать отправку ему электронной почты, он может и не заметить, если почта придёт не через 3 секунды, а через полминуты. Подобные задачи можно ставить в очередь, а их обработку поручить другим серверам, которые не будут отвечать на HTTP-запросы, а будут заниматься только подобными асинхронными, background, задачами.</p>

<p>Плюсы:</p>

<ul>
<li>Снижает время отклика для некоторых запросов (как правило, не для всех)</li>
<li>Освобождает ресурсы серверов, которые отвечает на запросы</li>
</ul>


<p>Минусы:</p>

<ul>
<li>Реализация может потребовать достаточно много времени</li>
<li>Не все задачи можно выполнять асинхронно</li>
</ul>


<h2>Статические файлы</h2>

<h3>Кэширование статики</h3>

<p>Плюсы:</p>

<ul>
<li>Уменьшает нагрузку как на веб-сервер, так и на канал</li>
</ul>


<p>Минусы:</p>

<ul>
<li>Если большинство клиентов - не браузеры (а, например, мобильные клиенты или другие веб-сервисы), они могут не поддерживать кэширование (HTTP-заголовки вроде Cache-Control и Expires), и изменения не будут иметь смысла</li>
</ul>


<h3>CDN</h3>

<p>Специализированные сервисы для раздачи статики, вроде AWS S3 или CloudFront, которые уже оптимизированы для таких задач.</p>

<p>Плюсы:</p>

<ul>
<li>Уменьшает нагрузку как на веб-сервер, так и на канал</li>
<li>В некоторых случаях может быть быстро и просто</li>
</ul>


<p>Минусы:</p>

<ul>
<li>В некоторых случаях может быть долго и сложно</li>
<li>Увеличение расходов на инфраструктуру</li>
</ul>


<h2>Внешние сервисы</h2>

<p>Для выполнение некоторых задач могут быть использованы веб-сервисы, предоставляемые внешними вендорами. Такое решение хорошо тем, что там не нужно самим реализовывать некоторые функции, а можно использовать то, что сделали другие. Но вместе с тем мы получаем отсутствие контроля над некоторыми аспектами приложения, в том числе и над временем выполнения.</p>

<h3>Замена внешнего сервиса внутренним</h3>

<p>Плюсы:</p>

<ul>
<li>Уменьшение (часто - существенное) времени обработки запросов (за счёт отсутствия необходимости делать запросы по сети)</li>
<li>Увеличение контроля над определённым функционалом приложения.</li>
</ul>


<p>Минусы:</p>

<ul>
<li>Реализация может занять длительное время</li>
<li>Увеличение количества поддерживаемого кода.</li>
</ul>


<h3>Сделать работу с внешними сервисами асинхронной</h3>

<p>См. раздел Асинхронное выполнение задач</p>

<h2>Несоответствие технологий</h2>

<p>Самый крайний случай. Все, наверное, знают историю про то, что Твиттер изначально был написан на Ruby on Rails, и быстрый рост популярности приводил к частым простоям сервиса. Было принято решение перейти на JVM (Java + Scala), и через некоторое время количество даунтаймов существенно снизилось.</p>

<p>Может оказаться, что выбранная платформа плохо подходит для высокой нагрузки (например, в Ruby на тот момент не было “честных” потоков, и работа с памятью в JVM сделана на порядок эффективней), и в долгосрочной перспективе может оказаться выгодным поменять технологический стек.</p>

<p>Плюсы:</p>

<ul>
<li>Любимая программистами возможность “выбросить всё и начать с нуля”</li>
</ul>


<p>Минусы:</p>

<ul>
<li>Ни о каком “быстром решении” не может быть и речи - будет долго и, соответственно, дорого.</li>
</ul>

]]></content>
  </entry>
  
</feed>
